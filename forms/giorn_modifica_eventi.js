/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C056F061-2680-46A3-B888-397F2AA3ECAB",variableType:4}
 */
var _idevento = -1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F9B8977A-31F2-4BE8-B138-DB74B132BE05"}
 */
var _codevento = ''

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"43CFA584-934C-40A5-BB59-B04D5D8B37E1"}
 */
var _descevento = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F5A29A98-5B9D-4B6C-ACC4-AD5A9000FBE1",variableType:4}
 */
var _ideventoclasse = -1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F483532A-20FD-4D02-8A1F-F0433123673B",variableType:4}
 */
var _idpropcl = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0C28166E-EE93-4721-BE03-D57A0F99B18F"}
 */
var _codprop = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5F7D3967-0D43-48D1-B9C1-D8A514DD50C7"}
 */
var _descprop = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"28FF6A63-4B16-4DAE-B1B0-B979AE8A57AD",variableType:4}
 */
var _importo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"40ADE9CE-B042-4DAD-B379-CFF5213CF432",variableType:8}
 */
var _ore = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"95191CEF-638F-4FD1-9273-F9E2F11CF3F4",variableType:4}
 */
var _oldIdEvento = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"34DE33A9-1AA0-4D9F-AA11-37F0600D2CB6"}
 */
var _oldCodEvento = '';

/**
 *  @param {Number} 
 *
 * @properties={typeid:24,uuid:"7AEEDE91-6FD0-40B1-8830-3834C440F30C"}
 */
var _oldIdPropCl = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"076018BC-04E1-4113-B3E5-0206AD26BDAA"}
 */
var _oldCodProp = '';

/**
 * @type {String}
 * 
 * @properties={typeid:35,uuid:"BCE7A33A-B643-4A8B-816F-38F261A7E9EA"}
 */
var _oldProprieta = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D5D23595-757D-4B42-A225-6FE740399518",variableType:4}
 */
var _oldOre = -1;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F322C1D9-15D8-463A-9330-EA4380D6E8A4",variableType:4}
 */
var _oldImporto = -1;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"0F5929FE-FCDE-4970-B770-F334B6092A3D",variableType:93}
 */
var _giornoEvento = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2A6C2EA4-71B9-4AC7-881C-7F31A23B1563",variableType:4}
 */
var vCoperturaOrarioTeorico = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"84C559EA-195F-43F4-AC7E-0757A3A4B5E0",variableType:4}
 */
var vCopiaSucc = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"16B8F8E6-954B-4131-A12C-ED2C48FC3B81",variableType:4}
 */
var vPortaInBudget = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D59176E8-693F-4563-ACBB-ED4E31C809C8",variableType:4}
 */
var _idDipendente = -1;
/**
 * @type {Array<Number>}
 * 
 *
 * @properties={typeid:35,uuid:"70C26E4F-BC57-4F92-BFC5-840BBA55A775",variableType:-4}
 */
var _arrGiorni = null;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D9040569-5802-4D90-88C8-E2EF4849EAEC",variableType:4}
 */
var _periodo = -1;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4BAFB859-37A3-4FF3-88E0-ED1B5CB661DB"}
 */
var _tipoGiornaliera = null;
/**
 * @type {Object}
 *
 * @properties={typeid:35,uuid:"613FEAF0-7E99-4F0E-915E-9BBAB25711F8",variableType:-4}
 */
var _ftrEvParams = null;
/**
 * @type {Array}
 *
 * @properties={typeid:35,uuid:"B5BF23BA-4A31-4CE5-A3F2-56AA7A967733",variableType:-4}
 */
var _arrIdPropSelezionabili = [];

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9017D00B-F236-44B4-849D-6B9D698082AD",variableType:4}
 */
var _totOre = 0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8E94EE97-402C-4D08-90C0-C0701F90FC5F",variableType:4}
 */
var _totOreTeorico = 0 

/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"88AE702D-2524-442D-B87D-5530DA242DBD",variableType:-4}
 */
var _isInModifica = false

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"40BF20AA-7757-41F9-BC3C-7D2735895E69",variableType:4}
 */
var _idGiornaliera = -1
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"26A597E4-3901-4B9E-87EC-5187C14ADC5A",variableType:4}
 */
var _idGiornalieraEvento = -1;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D8B04576-B24F-41CE-8049-1217465D5DF0"}
 */
var _segnalazioniOreInserite = '';


/**
 * @param {Number} idEvento
 * @param {Number} idEventoClasse 
 * @param {String} codEvento
 * @param {String} descEvento
 * @param {String} codProp
 * @param {String} descProp
 * @param {Number} hh
 * @param {Number} importo
 * @param {Number} oldIdEvento
 * @param {String} oldCodEvento
 * @param {String} oldCodProp
 * @param {Number} idPropCl
 * @param {Date} giornoEvento
 * @param {Number} idLavoratore
 * @param {Array<Number>} arrGiorniSelezionati
 * @param {Number} periodo
 * @param {String} tipoGiornaliera
 * @param {Number} idGiornaliera
 * @param {Number} idGiornalieraEvento
 * 
 * @properties={typeid:24,uuid:"DEE5061F-FA05-49A9-A088-691885FA2933"}
 */
function inizializzaValoriEvento(idEvento,idEventoClasse,codEvento,descEvento,codProp,descProp,hh,importo,oldIdEvento,oldCodEvento,oldCodProp,idPropCl,
	                             giornoEvento,idLavoratore,arrGiorniSelezionati,periodo,tipoGiornaliera,idGiornaliera,idGiornalieraEvento){
	
	_idevento = idEvento;
	_ideventoclasse = idEventoClasse;
	_codevento = codEvento ;
	_descevento = descEvento;
	_codprop = codProp;
	_descprop = descProp;
	_ore = hh;
	_importo = importo;
	_oldIdEvento = oldIdEvento;
	_oldCodEvento = oldCodEvento;
	_idpropcl = idPropCl; 
	_oldCodProp = oldCodProp;
	_giornoEvento = giornoEvento;
	_ore != null ? vCoperturaOrarioTeorico = 0 : vCoperturaOrarioTeorico = 1;
	_idDipendente = idLavoratore;
	_arrGiorni = arrGiorniSelezionati;
	_periodo = periodo;
	_tipoGiornaliera = tipoGiornaliera;
	_idGiornaliera = _idGiornaliera;
	_idGiornalieraEvento = idGiornalieraEvento;
}

/**
 * @properties={typeid:24,uuid:"49A3D6C6-C0FF-41FE-A53D-F828DA3D8E8B"}
 */
function getParametriEvento()
{
	if(_ore == null)
		_ore = 0;
	if(_codprop == null)
		_codprop = '';
	
	return globals.inizializzaParametriEvento(
			 	 globals.getDitta(_idDipendente)
				,_periodo
				,[]
				,_tipoGiornaliera
				,globals._tipoConnessione
				,[]
				,_idevento
				,_codprop
				,_ore 
				,_importo
				,_oldIdEvento
				,_oldCodProp
				,vCoperturaOrarioTeorico
				);
}

/**
 * 
 * @param {JSFoundset} _fs
 *
 * @properties={typeid:24,uuid:"37BA734F-32C4-4D7B-BFFB-618D2CC05A30"}
 */
function FiltraEvento(_fs) {
		
	//Aggiunta filtro eventi da risposta WS
	_fs.addFoundSetFilterParam('idevento','IN',globals._arrIdEvSelezionabili,'ftr_evSelezionabili');
	if(globals._tipoDiGiornaliera === globals.TipoGiornaliera.BUDGET)
		_fs.addFoundSetFilterParam('usainbudget','=',1);
    return _fs;
}

/**
 *
 * @param {JSFoundset} _fs
 *
 * @properties={typeid:24,uuid:"DECFADA0-F155-4EA1-89CB-DB0DC15506B4"}
 */
function FiltraProprieta(_fs)
{
	FiltraProprietaSelezionabili(_idevento);
	
	_fs.addFoundSetFilterParam('ideventoclasse','=',_ideventoclasse,'ftr_propSelezionabiliIdEventoClasse');
	_fs.addFoundSetFilterParam('ideventoclasseproprieta','IN',_arrIdPropSelezionabili,'ftr_propSelezionabiliIdEventoClasseProprieta');
	_fs.addFoundSetFilterParam('idevento', '=', _idevento, 'ftr_propSelezionabiliIdEvento');
	
	return _fs;	
}

/**
 * @param {JSRecord<db:/ma_presenze/e2eventi>} _rec
 * @param {JSEvent} [_event]
 * 
 * @properties={typeid:24,uuid:"A70B6CF2-97D8-4C5A-9CFD-0F5450D7E34A"}
 */
function AggiornaSelezioneEvento(_rec,_event){
	
	_idevento = _rec['idevento'];
	_ideventoclasse = _rec['ideventoclasse'];
	
	if (globals.needsCertificate(_ideventoclasse)) 
    {
    	globals.showStorico(_ideventoclasse, _giornoEvento.getDate(), _idDipendente, globals.getDitta(_idDipendente));
    	globals.ma_utl_setStatus(globals.Status.BROWSE,controller.getName());
			
    	if(_event)
			globals.svy_mod_closeForm(_event);
    	return;
	}
	
	AggiornaProprietaEvento(_rec);
	controller.focusField(elements.fld_mod_ore.getName(),false);
}

/**
 * @AllowToRunInFind 
 * @properties={typeid:24,uuid:"53DCBCBF-2C75-41FF-A8ED-F52AF8545DFA"}
 */
function aggiornaSelezioneEventoDaAlbero(returnDataProvider, tableName, mouseX, mouseY){
	
	/** @type {JSFoundSet<db:/ma_presenze/e2eventi>} */    
    var eventiFs = databaseManager.getFoundSet(globals.Server.MA_PRESENZE,globals.Table.EVENTI);
    
    if(eventiFs.find())
    {
    	eventiFs.idevento = returnDataProvider;
    	eventiFs.search();
    	
    	if(application.getWindow('win_lkp_albero_eventi'))
    	{
    		application.getWindow('win_lkp_albero_eventi').hide();
    	}
    	
    	//TODO creare metodo apposito per aggiornamento RP
    	forms.giorn_modifica_eventi_dtl.AggiornaSelezioneEvento(eventiFs.getRecord(1));        
    }
}

/**
 * @param {Number} idevento
 * 
 * @properties={typeid:24,uuid:"4E43F95A-4D0C-4F19-9764-80A1854705D6"}
 * @AllowToRunInFind
 */
function confermaSelezioneEventoDaAlbero(idevento)
{
	/** @type {JSFoundSet<db:/ma_presenze/e2eventi>} */    
    var eventiFs = databaseManager.getFoundSet(globals.Server.MA_PRESENZE,globals.Table.EVENTI);
    
    if(eventiFs.find())
    {
    	eventiFs.idevento = idevento;
    	eventiFs.search();
    	
    	if (globals.needsCertificate(eventiFs.ideventoclasse)) 
		{
		    globals.ma_utl_showWarningDialog('L\'evento è gestibile solo attraverso le certificazioni','Conferma selezione evento');
		    _codevento = '';
		    return;
		}
    	
    	if(eventiFs.e2eventi_to_e2eventiclassi &&
    			(eventiFs.e2eventi_to_e2eventiclassi.tipo == globals.TipoEvento.STATISTICO
    		     || eventiFs.e2eventi_to_e2eventiclassi.tipo == globals.TipoEvento.AGGIUNTIVO))
		{
			elements.chk_copertura.enabled = false;
			vCoperturaOrarioTeorico = 0;
		}
		else
		    elements.chk_copertura.enabled = true;
    	
    	forms.giorn_modifica_eventi_dtl.AggiornaSelezioneEvento(eventiFs.getRecord(1));    	
    }	  
}

/**
 * @param {JSRecord<db:/ma_presenze/e2eventi>} _rec
 *
 * @properties={typeid:24,uuid:"8F1032F8-32D4-4470-87DE-6297A5CF17B8"}
 * @AllowToRunInFind
 */
function AggiornaProprietaEvento(_rec) 
{
	_idevento = _rec['idevento'];
	_codevento = _rec['evento'];
	_descevento = _rec['descriz'];
	_ideventoclasse = _rec['ideventoclasse'];

	if (_rec.e2eventi_to_e2eventiclassi && (_rec.e2eventi_to_e2eventiclassi.tipo == 'O'
		                                      || _rec.e2eventi_to_e2eventiclassi.tipo == 'S'))
	{
		if(!_isInModifica)
		   vCoperturaOrarioTeorico = true;
		
		elements.chk_copertura.enabled = true;
		elements.lbl_copertura.enabled = true;
		
	}
	else
	{
		if(!_isInModifica)
		   vCoperturaOrarioTeorico = false;
		
		elements.chk_copertura.enabled = false;
		elements.lbl_copertura.enabled = false;
	}

	// Seleziona la prima proprietà disponibile per l'evento selezionato nel giorno selezionato
	FiltraProprietaSelezionabili(_idevento)

	var proprietaFoundset = _rec.e2eventi_to_e2eventiclassiproprieta;

	if (proprietaFoundset.find()) 
	{
		proprietaFoundset.ideventoclasseproprieta = _arrIdPropSelezionabili;
		proprietaFoundset.search();

		if (proprietaFoundset && proprietaFoundset.getSize() > 0) 
		{
			if(_oldCodProp)
			{
			   var propCopyFoundset = proprietaFoundset.duplicateFoundSet();
			   if(propCopyFoundset.find())
			   {
				   propCopyFoundset.codiceproprieta = _oldCodProp;
				   if(propCopyFoundset.search() == 0)
				   {
					   _codprop = proprietaFoundset.codiceproprieta;
					   _descprop = proprietaFoundset.descrizione;   
				   }
			   }
			   else
			   {
				   _codprop = proprietaFoundset.codiceproprieta;
				   _descprop = proprietaFoundset.descrizione;
			   }
			   
			}
			else
			{
				_codprop = proprietaFoundset.codiceproprieta;
				_descprop = proprietaFoundset.descrizione;
			}
			abilitaProprieta(true);
		}
		else
		{
			_codprop = "";
			_descprop = "";
			
			abilitaProprieta(false);
		}
		
		globals.svy_nav_setFieldsColor(controller.getName(),globals.Status.EDIT);
	} 
	else
	{
		globals.ma_utl_showErrorDialog('Cannot go to find mode : proprieta', 'Servoy Error')
		_codprop = "";
		_descprop = "";
	}
}


/**
 * @param {JSRecord<db:/ma_presenze/e2eventi>} _rec
 *
 * @properties={typeid:24,uuid:"3E5650A4-3230-4012-8065-FC5CEFE8885C"}
 */
function AggiornaProprieta(_rec) {
	
	_idpropcl = _rec['ideventoclasseproprieta'];
	_codprop = _rec['codiceproprieta'];
	_descprop = _rec['descrizione'];

}

/**
 * @param {String} oldValue
 * @param {String} newValue
 * @param {JSEvent} event
 *
 * @properties={typeid:24,uuid:"C43BDAB5-AA52-4021-9CEF-426CF9E1148F"}
 * @AllowToRunInFind
 */
function onDataChangeEvento(oldValue, newValue, event) {

	if(newValue == null || newValue == '')
		newValue = oldValue;
	
	// escape character \ per corsi aziendali
	var uriEn = escape(newValue.toString());
	if(uriEn == escape('\\'))
	   newValue = '\\\\';
	else if(uriEn == escape('#'))
		newValue = '##';
	
	/** @type {JSFoundSet<db:/ma_presenze/e2eventi>} */
	var _foundset = databaseManager.getFoundSet(globals.Server.MA_PRESENZE,globals.Table.EVENTI);
	
	// Filtra gli eventi selezionabili
	if (_foundset.find()) 
	{
		_foundset.idevento = globals._arrIdEvSelezionabili;
		_foundset.evento = newValue;
		
		if (_tipoGiornaliera == globals.TipoGiornaliera.BUDGET)
		{
			_foundset.usainbudget = 1;
			_foundset.e2eventi_to_e2eventiclassi.gestitoconstorico = 0;
		}
		_foundset.search();

		if (_foundset.getSize() == 1) {

			_idevento = _foundset['idevento'];
			_descevento = _foundset['descriz'];
			_ideventoclasse = _foundset['ideventoclasse'];

			if (globals.needsCertificate(_ideventoclasse)) 
			{
				_idevento = -1;
				_codevento = '';
				_descevento = '';
				
				globals.svy_mod_closeForm(event);
				// Open the form to handle the correct type of certificate
				globals.showStorico(_ideventoclasse, _giornoEvento.getDate(), _idDipendente, globals.getDitta(_idDipendente));

			} 
			else
			{
				if(_foundset.e2eventi_to_e2eventiclassi.tipo == globals.TipoEvento.STATISTICO
					|| _foundset.e2eventi_to_e2eventiclassi.tipo == globals.TipoEvento.AGGIUNTIVO)
				{
					elements.chk_copertura.enabled = false;
					vCoperturaOrarioTeorico = 0;
				}
				else
				    elements.chk_copertura.enabled = true;
			
				return AggiornaSelezioneEvento(_foundset.getSelectedRecord(), event);
			}
			
		} 
		else 
		{
			_codevento = oldValue;
			showLkpAlberoEventi(event);
		}
	}
	return true;
}


/**
 * 
 * @param {String} oldValue
 * @param {String} newValue
 * @param {JSEvent} event
 *
 * @properties={typeid:24,uuid:"53CEE28D-2CCD-4F92-8204-41F3CD57BD00"}
 */
function onDataChangeProp(oldValue, newValue, event) {

	var _foundset = databaseManager.getFoundSet(globals.nav.program['LEAF_Lkp_Eventiproprieta'].server_name,
		                                        globals.nav.program['LEAF_Lkp_Eventiproprieta'].table_name)
	_oldIdEvento = _idevento;
	_oldCodProp = _codprop;
    _oldIdPropCl = _idpropcl;
	
    _foundset.addFoundSetFilterParam('idevento','=',_idevento);
	_foundset.addFoundSetFilterParam('ideventoclasse', '=', _ideventoclasse);
	_foundset.addFoundSetFilterParam('codiceproprieta', '=', newValue);
	_foundset.loadAllRecords();

	if (_foundset.getSize() == 1) 
	{
		_oldIdPropCl = _foundset['ideventoclasseproprieta'];
		_codprop = _foundset['codiceproprieta'];
		_descprop = _foundset['descrizione'];
		
	} else {
		
		_codprop = oldValue;
		
		globals.svy_nav_showLookupWindow(event, '_codprop', 'LEAF_Lkp_Eventiproprieta', 'AggiornaProprieta',
			                             'FiltraProprieta', null, null, 'codiceproprieta', true);
	}

	return true;
}

/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"5B8A1929-3868-441B-B8F2-AB3CF9C0B514"}
 */
function onDataChangeOre(oldValue, newValue, event)
{
    _oldOre = oldValue;
	
	//se viene inserito un numero di ore >= 0 (può esistere un evento con ore a zero)
	if(newValue > 0 || oldValue > 0)
		vCoperturaOrarioTeorico = 0;
	if(newValue == null)
	    vCoperturaOrarioTeorico = 1;
	
	if(!isValid(newValue))
		_ore = oldValue;
	else
		_totOre = _totOre - oldValue * 100 + newValue * 100;
		
	verificaOrarioTeorico();
	
	return true;
}

/**
 * @properties={typeid:24,uuid:"BF375D6E-18E8-46E3-8044-728E721657E7"}
 * 
 * @return {Boolean}
 * @AllowToRunInFind
 */
function isValid(value)
{
//	var regexp = /^\d{1,2}(\.[0,2,5,7]{1}[0,5]?)?$/g;
	return value >= 0 && value <= 24;// && value.toString().search(regexp) >= 0;
}

/**
 * @param {Number} idEvento
 * @param {Number} [idLav]
 * @param {Number} [periodo]
 * @param {Number} [gg]
 * @param {String} [tipoGiorn]
 * 
 * @properties={typeid:24,uuid:"891C54E3-0F4B-45D6-8711-66F148571CD7"}
 */
function FiltraProprietaSelezionabili(idEvento,idLav,periodo,gg,tipoGiorn)
{	
	var response = globals.getProprietaSelezionabili(idEvento,
		idLav || _idDipendente,
		periodo || _periodo,
		gg || _giornoEvento.getDate(),
		tipoGiorn || _tipoGiornaliera);

	if(response && response.StatusCode == globals.HTTPStatusCode.OK)
	{
		/** @type {Array} */
		_arrIdPropSelezionabili = response.ReturnValue;
		if (!(_arrIdPropSelezionabili && _arrIdPropSelezionabili.length > 0))
			globals.ma_utl_showWarningDialog('Non esistono proprietà selezionabili, riprovare o verificare','Filtraggio proprietà selezionabili evento');
	}
	else
		globals.ma_utl_showWarningDialog('Errore durante il recupero delle proprietà dell\'evento','Filtraggio proprietà selezionabili evento');
}

/**
 * @properties={typeid:24,uuid:"8624E7D4-4C3A-4D51-A769-B9DDAA11D07B"}
 */
function isFilled()
{
	return _idevento && _idevento > 0;
}

/**
 * Verifica e segnala l'eventuale immissione di una quantità
 * di ore superiore al valore teorico. E' solo una segnalazione visiva
 * i possibile blocco avviene al momento della conferma
 * 
 * @properties={typeid:24,uuid:"AFE549F2-1511-4C4A-8B02-7510710359C4"}
 * @AllowToRunInFind
 */
function verificaOrarioTeorico()
{
	// Verifica che l'evento sia Ordinario o Sostitutivo, altrimenti annulla il controllo
	/** @type {JSFoundSet<db:/ma_presenze/e2eventi>} */
	var eventiFs = databaseManager.getFoundSet(globals.Server.MA_PRESENZE, globals.Table.EVENTI);
	if(eventiFs && eventiFs.find())
	{
		eventiFs.idevento = _idevento;
		if(eventiFs.search() > 0)
		{		
			var tipoEvento = eventiFs.e2eventi_to_e2eventiclassi.tipo;
			if(tipoEvento !== globals.TipoEvento.ORDINARIO && tipoEvento !== globals.TipoEvento.SOSTITUTIVO)
				return;
		}
	}
	else
		return;
		
	if(_totOre != _totOreTeorico)
	{
		if(elements.lbl_previste_inserite)
		   elements.lbl_previste_inserite.fgcolor = 'red';
		_segnalazioniOreInserite = 'Ore previste : ' + (_totOreTeorico / 100).toFixed(2) + ' - Ore inserite : ' + (_totOre / 100).toFixed(2);	
	}
	else
	{
		if(elements.lbl_previste_inserite)
		{
			elements.lbl_previste_inserite.fgcolor = '#31AD12';
			_segnalazioniOreInserite = 'Ore previste : ' + (_totOreTeorico / 100).toFixed(2);
		}
		else
			_segnalazioniOreInserite = '';
	}
}

/**
 * Gestione della risposta alla chiamata sugli informativi dell'evento
 * 
 * @param {{ ReturnValue: Boolean, Message: String }} response
 *
 * @properties={typeid:24,uuid:"FFFB8853-8C0A-4DDE-9603-96F17B707E9C"}
 */
function gestioneInformativiStatistici(response)
{
	//se ci sono messaggi visualizziamoli
	if(response.Message && response.Message != '') 
	{
		//se ci sono blocchi su informativi statistici resettiamo l'inserimento dell'evento
		if(!response.ReturnValue)
		{
			_idevento = null;
			_codevento = ''
			_descevento = '';
			_ideventoclasse = null;
			_idpropcl = null;
			_codprop = '';
			_descprop = '';
			_importo = 0;
			_ore = null;
			_oldIdEvento = null;
			_oldCodEvento = '';
			_oldIdPropCl = null;
			_oldCodProp = '';
			_oldOre = -1;
			_oldImporto = -1;
			vCoperturaOrarioTeorico = 1;
		}
		
		//se c'è il blocco viene mostrato il messaggio
		var innerMsg = ("<p>" + response.Message + '</p>');
		globals.ma_utl_showWarningDialog(innerMsg, 'Controllo informativi statistici');
	}	
	return response.ReturnValue;
}

/**
 * Handle focus gained event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @private
 *
 * @properties={typeid:24,uuid:"C2379B9C-DCE2-41F6-AAC1-83800FC3DBD1"}
 */
function onFocusGainedOre(event) {
	if(!_ore)
		_ore = 0.00;
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @private
 *
 * @properties={typeid:24,uuid:"9EF3753E-7895-45E2-8F59-67FF7C8F8ADA"}
 */
function onDataChangeCoperturaOrario(oldValue, newValue, event) {
	
     vCoperturaOrarioTeorico = newValue;
	 if(vCoperturaOrarioTeorico)
	 {
		 _ore = 0;			
		 verificaOrarioTeorico();
		 _ore = null;
	 }
	 
	 return true;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D0D6E7EB-D23D-4CE1-AD0D-0C72DE67A57F"}
 */
function showLkpAlberoEventi(event) 
{
	forms.giorn_lkp_eventi._destFormName = controller.getName();
	forms.giorn_lkp_eventi.arrIdEventi = globals._arrIdEvSelezionabili;
	globals.ma_utl_showFormInDialog(forms.giorn_lkp_eventi.controller.getName(),'Eventi selezionabili');
}

/**
 * @param {Boolean} abilita
 *
 * @properties={typeid:24,uuid:"61EAA50E-E0D6-4073-90E6-FB9BC3F427B0"}
 */
function abilitaProprieta(abilita) 
{
	if(elements.fld_mod_codiceproprieta)
	   elements.fld_mod_codiceproprieta.enabled = abilita;
	if(elements.btn_mod_prop)
	   elements.btn_mod_prop.enabled = abilita;
	if(elements.fld_mod_descproprieta)
	   elements.fld_mod_descproprieta.enabled = abilita;
}



/** *
 * @param _firstShow
 * @param _event
 *
 * @properties={typeid:24,uuid:"ED4947A5-7E6C-4050-B796-C11413A5B9F5"}
 */
function onShowForm(_firstShow, _event)
{
	plugins.busy.prepare();
	
	if(globals._arrIdEvSelezionabili == null || globals._arrIdEvSelezionabili == [])
	   globals.FiltraEventiSelezionabili(_idDipendente,_periodo,_tipoGiornaliera);
		
	// se in modifica di un evento esistente la copertura dev'essere sflaggata 
	if(_isInModifica)
		vCoperturaOrarioTeorico = 0;
	else
	{
		_idevento = null;
		_codevento = '';
		_idpropcl = null;
		_codprop = '';
		_descevento = '';
		_descprop = '';
	}
	
    _oldIdEvento = _idevento;
	_oldCodEvento = _codevento;
	_oldIdPropCl = _idpropcl;
	_oldCodProp = _codprop;
	
	// caso evento multiplo
	
	if(_codprop != '' || _codprop == '' && !_isInModifica)
	{
		//abilitiamo gli elementi delle proprietà (venendo da un caso in cui le proprietà non sono selezionabili
		//manterrebbe gli elementi non selezionati anche se effettivamente selezionabili)
		abilitaProprieta(true);
	}
	else
		abilitaProprieta(false);
		
    //segnala visivamente superamento orario teorico
    verificaOrarioTeorico();
	
	// Automatically put the event form in edit mode
	if(controller.readOnly)
		controller.readOnly = false;
    
	globals.svy_nav_setFieldsColor(controller.getName(),globals.Status.EDIT);
}
